<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Floroid</title>
  <style type="text/css">
  body {
      margin: 0;
      font: 12px sans-serif;
      overflow: hidden; 
  }
  * { box-sizing: border-box; }

  #container {
      position: relative;
  }

  canvas {
      position: fixed;
      top: 0;
      left: 0;
  }

  #menu, #ui {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
  }

  #menu {
      margin: 1em;
  }

  #menu:hover circle{
      fill: rgb(152, 54, 38);
  }

  #menu:hover rect {
      fill: #fff;
  }

  #ui {
      z-index: 10;
      text-align: left;
      margin: 0;
      width: 240px;
      background-color: #fff;
      transition: all 300ms ease-in;
      overflow-y: auto;
      overflow-x: hidden;
  }

  .moverIzq {
      transform: translateX(-100%);
  }

  #ui > *  {
      margin: 0 auto 1ex auto;
      font-weight: 700;
      width: 180px;
  }

  #ui #description {
      font-size: 110%;
      font-weight: 100;
  }

  #ui #description h1 {
      font-size: 160%;
      font-weight: 100;
  }

  #ui button, #ui .file-btn, #ui #close {
    font-size: 13.3px;
    padding: 1ex;
    display: block;
    background-color: #fff;
    border: 2px solid #000;
  }

  #ui .toggle {
    color: green;
    border-color: green;
  }

  #ui .deactivated {
    color: rgb(152, 54, 38);
    border-color: rgb(152, 54, 38);
  }

  #ui #close {
    width: auto;
    margin-top: 10px;
    margin-bottom: 30px;
    font-weight: 100;
    color: rgb(152, 54, 38);
    background-color: #fff;
    border: none;
  }

  #ui button:hover, #ui .file-btn:hover {
    background-color: #000;
    color: #fff;
    border-color: #fff;
  }

  #ui .toggle:hover {
    background-color: green;
  }

  #ui .deactivated:hover {
    background-color: rgb(152, 54, 38);
  }

  #ui #close:hover {
    background-color: #fff;
    color: #000;
    border: none;
  }

  #ui .slider {
    padding: 0;
  }

  #ui .slider input {
    margin: 1ex 0 0 0;
    width: 180px;
  }

  #ui hr {
      border: none;
      border-top: 2px dotted rgb(152, 54, 38);
      margin-top: 15px;
      margin-bottom: 15px;
      height: 5px;
  }

  /*remove style from input file*/
  #ui .file-btn {
      position: relative;
      text-align: center;
  }

  #ui input[type="file"] {
    position: absolute;
    opacity: 0;
    overflow: hidden;
  }

  #ui > :last-child { margin-bottom: 40px; }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="canvas1"></canvas>
    <canvas id="canvas2"></canvas>
  </div>
  <script>
!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);class s{constructor(t,e){this.x=t,this.y=e}static fromPolar(t,e){const n=t*Math.cos(e),s=t*Math.sin(e);return new this(Math.floor(n),Math.floor(s))}static add(t,e){return new this(t.x+e.x,t.y+e.y)}static sub(t,e){return new this(t.x-e.x,t.y-e.y)}static eq(t,e){return t.x===e.x&&t.y===e.y}add(t){return this.x+=t.x,this.y+=t.y,this}addX(t){return this.x+=t,this}addY(t){return this.y+=t,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subX(t){return this.x-=t,this}subY(t){return this.y-=t,this}mul(t){return this.x=this.x*t,this.y=this.y*t,this}div(t){if(0!==t)return this.x=this.x/t,this.y=this.y/t,this}getMagnitude(){return Math.hypot(this.x,this.y)}normalize(){const t=this.getMagnitude();return this.div(t),this}getDistance(t){const e=t.x-this.x,n=t.y-this.y;return Math.hypot(e,n)}getAngle(t){return Math.atan2(t.y-this.y,t.x-this.x)}eq(t){return this.x===t.x&&this.y===t.y}quasiEq(t){return Math.abs(this.x-t.x)<=1&&this.y===t.y||this.x===t.x&&Math.abs(this.y-t.y)<=1}copy(){return new s(this.x,this.y)}}function i(t,e,n,s){t.fillStyle=e,t.beginPath(),t.arc(s.x,s.y,n,0,2*Math.PI,!1),t.fill()}function o(t,e,n=!0){const s=n=>Math.random()*(e-t)+t;return n?Math.floor(s()):s()}class r{constructor({center:t,radius:e,speed:n,centerDistance:s,startingIndex:i,pathType:o,sides:r}){this.center=t,this.radius=e,this.speed=n,this.path=[],this.genPath({centerDistance:s,startingIndex:i,pathType:o,sides:r}),this.currentIndex=Math.floor((this.path.length-1)*i),this.currentPosition=null,this.updatePosition()}updatePosition(){this.currentPosition=this.path[this.currentIndex].copy(),this.currentPosition.add(this.center.currentPosition)}genPath({centerDistance:t,startingIndex:e,pathType:n="circle",sides:i=3}){const o=new Map([["circle",t=>t],["polygon",(t,e,n=3)=>{const s=n>2?n:3;return t=t*Math.cos(Math.PI/s)/Math.cos(e%(2*Math.PI/s)-Math.PI/s)}],["crazy",(t,e)=>t*Math.cos(e)*Math.sin(10)*Math.sin(e*t)+100]]),r=Math.floor(2*Math.PI/this.speed);this.path=Array.from({length:r},(e,r)=>{const a=r*this.speed,h=o.get(n)(t,a,i);return s.fromPolar(h,a)})}draw(t){i(t,"#fff",this.radius,this.currentPosition);const e=this.path.map(t=>t.copy().add(this.center.currentPosition));t.beginPath(),e.forEach(e=>t.lineTo(e.x,e.y)),t.closePath(),t.stroke()}update(){this.currentIndex++,this.currentIndex=this.currentIndex%this.path.length,this.updatePosition()}}class a{constructor({main:t,secondary:e}){const n=new r(t);let s=n;const i=e.map(t=>{const e=new r(Object.assign(t,{center:s}));return s=e,e});this.components=[n].concat(i),this.last=this.components[this.components.length-1]}draw(t){this.components.forEach(e=>e.draw(t))}update(){this.components.forEach(t=>t.update())}}class h{constructor({gear1:t,gear2:e,common:n,rodLength:s,penColor:i,lineWidth:o}){this.gear1=new a({main:Object.assign(t.main,n),secondary:t.secondary}),this.gear2=new a({main:Object.assign(e.main,n),secondary:e.secondary}),this.rodLength=s,this.penColor=i,this.lineWidth=o,[this.headPoint,this.penPoint,this.endPoint]=this.getRodPoints()}getRodPoints(){const t=s.sub(this.gear2.last.currentPosition,this.gear1.last.currentPosition).normalize(),e=this.gear1.last.currentPosition.copy(),n=this.gear2.last.currentPosition.copy();return[e,e.copy().add(t.copy().mul(this.rodLength)),n]}draw(t){this.gear1.draw(t),this.gear2.draw(t),t.beginPath(),t.moveTo(this.headPoint.x,this.headPoint.y),t.lineTo(this.endPoint.x,this.endPoint.y),t.stroke(),i(t,this.penColor,5,this.penPoint)}update(){this.gear1.update(),this.gear2.update(),[this.headPoint,this.penPoint,this.endPoint]=this.getRodPoints()}}function c(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.entries(e).forEach(t=>{n.setAttribute(t[0],t[1])}),n}class d{constructor({scope:t,shouldDraw:e=!0,shouldUpdate:n=!0,hasMenuBtn:s=!0}){this.reset(),this.scope=t,this.shouldUpdate=n,this.shouldDraw=e,this.hasMenuBtn=s,this.menu=Object.assign(document.createElement("div"),{id:"ui"}),this.closeBtn=Object.assign(document.createElement("button"),{textContent:"[ close ]",id:"close"}),this.render(),this.eventListener()}reset(){const t=document.querySelector("#ui");t&&t.parentNode.removeChild(t)}addSeparator(){const t=document.createElement("hr");this.menu.appendChild(t)}render(){if(this.hasMenuBtn){this.svg=c("svg",{width:45,height:45,id:"menu"});const t=c("circle",{cx:22.5,cy:22.5,r:22.5,fill:"#fff"});this.svg.appendChild(t);const e=c("rect",{x:10,y:10,width:25,height:5,fill:"#000"});this.svg.appendChild(e);const n=c("rect",{x:10,y:20,width:25,height:5,fill:"#000"});this.svg.appendChild(n);const s=c("rect",{x:10,y:30,width:25,height:5,fill:"#000"});this.svg.appendChild(s),document.body.appendChild(this.svg),this.menu.classList.add("moverIzq")}this.menu.appendChild(this.closeBtn),document.body.appendChild(this.menu)}eventListener(){this.hasMenuBtn&&this.svg.addEventListener("click",this.openEventHandler.bind(this),{once:!0}),this.menu.addEventListener("change",this.updateEventhandler.bind(this)),this.menu.addEventListener("click",this.updateEventhandler.bind(this))}openEventHandler(t){this.menu.classList.remove("moverIzq"),this.closeBtn.addEventListener("click",this.closeEventHandler.bind(this),{once:!0})}closeEventHandler(t){this.menu.classList.add("moverIzq"),t.stopPropagation(),this.svg.addEventListener("click",this.openEventHandler.bind(this),{once:!0})}updateEventhandler(t){("change"===t.type&&"range"===t.target.type||"click"===t.type&&"BUTTON"===t.target.nodeName)&&(this.shouldUpdate&&this.scope.update(),this.shouldDraw&&this.scope.draw())}}class l{constructor({text:t,scope:e,prop:n,toggleValue:s=!0}){this.scope=e,this.prop=n,this.btn=Object.assign(document.createElement("button"),{textContent:t,id:n}),this.toggleValue=s,this.btn.classList.add("toggle"),this.render(),this.eventListener()}render(){document.querySelector("#ui").appendChild(this.btn)}eventListener(){this.btn.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.btn.classList.toggle("deactivated"),this.toggleValue=!this.toggleValue,this.scope[this.prop]=this.toggleValue}}class p{constructor({text:t,scope:e,prop:n,type:s="image"}){this.scope=e,this.prop=n,this.type=s,this.text=t,this.fileInput=Object.assign(document.createElement("input"),{type:"file",id:n}),this.render(),this.eventListener()}render(){const t=document.querySelector("#ui"),e=Object.assign(document.createElement("label"),{textContent:this.text});e.classList.add("file-btn"),e.appendChild(this.fileInput),t.appendChild(e)}eventListener(){this.fileInput.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){const e=new FileReader;e.onload=(t=>{const e="json"===this.type?JSON.parse(t.target.result):t.target.result,n=this.prop?{[this.prop]:e}:e;this.scope.init(n)}),"image"===this.type&&e.readAsDataURL(t.target.files[0]),"json"===this.type&&e.readAsText(t.target.files[0])}}class u{constructor({text:t,scope:e,prop:n}){this.scope=e,this.prop=n,this.btn=Object.assign(document.createElement("button"),{textContent:t}),this.render(),this.eventListener()}render(){document.querySelector("#ui").appendChild(this.btn)}eventListener(){this.btn.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){window.open(this.scope[this.prop],"_blank").focus()}}class g{constructor({playText:t,stopText:e,scope:n}){this.playText=t,this.stopText=e,this.animate=function(t,e=0){let n,s=!1;const i=function(t){let e=0,n=0;const s=t;return t=>{let i=t-e;if(e=t,(n+=i)>s)return n=0,!0}}(e),o=t=>{s||(s=!0),n=window.requestAnimationFrame(a)},r=t=>{n&&(window.cancelAnimationFrame(n),n=void 0,s=!1)},a=(e=0)=>{i(e)&&t(),o()};return{start:o,stop:r,toggle:t=>{(s=!s)?o():r()},get animating(){return s}}}(t=>{n.draw(),n.update()}),this.btn=Object.assign(document.createElement("button"),{textContent:t,id:"play"}),this.btn.classList.add("toggle"),this.render(),this.eventListener()}render(){document.querySelector("#ui").appendChild(this.btn)}eventListener(){this.btn.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.animate.toggle(),this.btn.classList.toggle("deactivated"),this.btn.textContent=this.animate.animating?this.stopText:this.playText,t.stopPropagation()}}class m{constructor(t,e){this.title=t,this.text=e,this.render()}render(){const t=document.querySelector("#ui"),e=document.createElement("div");e.id="description";const n=document.createElement("h1");n.textContent=this.title,e.appendChild(n),this.text.forEach(t=>{const n=document.createElement("p");n.textContent=t,e.appendChild(n)}),t.appendChild(e)}}class y{constructor(t,e){this.ctx1=t,this.ctx2=e,this.origin=new s(t.canvas.width/2,t.canvas.height/2)}init(t){this.jsonOptions=JSON.stringify(t),this.backgroundColor=t.sketch.backgroundColor,this.drawComponents=t.sketch.drawComponents,this.componentsColor=t.sketch.componentsColor,this.drawingPistons=t.sketch.drawingPistons.map(t=>{t.common.center||(t.common.center={currentPosition:this.origin});const e=new h(t);return{drawingPiston:e,previousPenPoint:e.penPoint.copy()}}),this.setBindings(),this.setupCanvas1(),this.setupCanvas2(),this.draw()}setBindings(){this.menu=new d({scope:this,shouldUpdate:!1}),this.description=new m("Floroid",["A crazy reinterpretation of the spirograph toy.",'Press "play" to begin the animation. Every "gear" that moves             the pen can be turned off. Enjoy!']),this.menu.addSeparator(),this.playBtn=new g({playText:"play",stopText:"stop",scope:this}),this.gearsBtn=new l({text:"gears",scope:this,prop:"drawComponents"}),this.menu.addSeparator(),this.uploadJsonBtn=new p({text:"up JSON",scope:this,type:"json"}),this.getJsonBtn=new u({text:"get JSON",scope:this,prop:"json"}),this.getImgBtn=new u({text:"get IMG",scope:this,prop:"png"})}get json(){return`data:application/json,${encodeURIComponent(this.jsonOptions)}`}get png(){const t=Object.assign(document.createElement("canvas"),{width:this.ctx1.canvas.width,height:this.ctx1.canvas.height}).getContext("2d");return t.drawImage(this.ctx1.canvas,0,0),t.drawImage(this.ctx2.canvas,0,0),t.canvas.toDataURL("image/png")}setupCanvas1(){this.ctx1.fillStyle=this.backgroundColor,this.ctx1.fillRect(0,0,this.ctx1.canvas.width,this.ctx1.canvas.height)}setupCanvas2(){this.ctx2.strokeStyle=this.componentsColor,this.ctx2.lineWidth=2}clean(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}draw(){this.clean(this.ctx2),this.drawingPistons.forEach(t=>{this.drawComponents&&t.drawingPiston.draw(this.ctx2),this.ctx1.strokeStyle=t.drawingPiston.penColor,this.ctx1.lineWidth=t.drawingPiston.lineWidth,this.ctx1.beginPath(),this.ctx1.moveTo(t.previousPenPoint.x,t.previousPenPoint.y),this.ctx1.lineTo(t.drawingPiston.penPoint.x,t.drawingPiston.penPoint.y),this.ctx1.stroke()})}update(){this.drawingPistons.forEach(t=>{t.previousPenPoint=t.drawingPiston.penPoint.copy(),t.drawingPiston.update()})}}const x={canvas:{random:!0},sketch:{drawComponents:!0,drawingPistons:{min:1,max:3,rodLength:{min:30},lineWidth:{min:.3,max:.7},centerDistance:{min:.5,max:.8},sides:{min:3,max:8},common:{speeds:[.05,.07,.09,.03],pathTypes:["circle","polygon","polygon"]},gearSecondary:{number:{min:2,max:4},centerDistance:{min:.15,max:.45},sides:{min:3,max:6}}}}};class w{constructor({h:t,s:e,l:n}){this.original={h:t,s:e,l:n},[this.h,this.s,this.l]=[t,e,n]}static getRandom(){return{h:v(0,300),s:v(0,100),l:v(0,100)}}reset(){return[this.h,this.s,this.l]=this.original,this}toOpposite(){return this.h=(this.h+180)%300,this.s=(this.s+50)%100,this.l=(this.l+50)%100,this}randomize({maxH:t=150,maxS:e=10,maxL:n=10}={}){return this.h=(v(0,t)+this.h)%300,this.s=(v(0,e)+this.s)%100,this.l=(v(0,n)+this.l)%100,this}toString(){return`hsl(${this.h}, ${this.s}%, ${this.l}%)`}hslToRgb(){let t,e,n;if(0==this.s)t=e=n=this.l;else{function s(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}const i=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,o=2*this.l-i;t=s(o,i,this.h+1/3),e=s(o,i,this.h),n=s(o,i,this.h-1/3)}return{r:255*t,g:255*e,b:255*n}}}function v(t,e,n=!0){const s=n=>Math.random()*(e-t)+t;return n?Math.floor(s()):s()}function f(t){const e=t.speeds[o(0,t.speeds.length)];return Array.from({length:o(t.number.min,t.number.max)},n=>({radius:4,startingIndex:Math.random(),speed:e,centerDistance:o(t.centerDistance.min,t.centerDistance.max),pathType:t.pathTypes[o(0,t.pathTypes.length)],sides:o(t.sides.min,t.sides.max)}))}function P(t){const e=Math.min(window.innerWidth,window.innerHeight)/2;return t.centerDistance.min*=e,t.centerDistance.max*=e,t}function b(t){const e=t.sketch,n=new w(w.getRandom());e.drawingPistons=P(e.drawingPistons),e.drawingPistons.gearSecondary=P(e.drawingPistons.gearSecondary);const s={backgroundColor:n.toString(),drawComponents:e.drawComponents,componentsColor:n.toOpposite().toString(),drawingPistons:Array.from({length:o(e.drawingPistons.min,e.drawingPistons.max)},t=>(function(t,e){const n=o(.1,.3,!1),s=o(t.centerDistance.min,t.centerDistance.max);return{rodLength:o(t.rodLength.min,s),penColor:e.randomize().toString(),lineWidth:o(t.lineWidth.min,t.lineWidth.max,!1),common:{center:null,speed:t.common.speeds[o(0,t.common.speeds.length)],centerDistance:s,pathType:t.common.pathTypes[o(0,t.common.pathTypes.length)],sides:o(t.sides.min,t.sides.max)},gear1:{main:{radius:5,startingIndex:n},secondary:f(Object.assign(t.gearSecondary,t.common))},gear2:{main:{radius:5,startingIndex:n+o(.3,.6,!1)},secondary:f(Object.assign(t.gearSecondary,t.common))}}})(e.drawingPistons,n))};return{canvas:t.canvas,sketch:s}}!function(){const t=document.querySelector("#canvas1");t.width=window.innerWidth,t.height=window.innerHeight;const e=t.getContext("2d"),n=document.querySelector("#canvas2");n.width=window.innerWidth,n.height=window.innerHeight;const s=n.getContext("2d");new y(e,s).init(b(x))}()}]);
  </script>
</body>
</html>
